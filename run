#!/bin/bash

source ./scripts/getopts
source ./config/env

if [[ "${atac:-}" == "TRUE" ]]
then
  SEURAT_IMAGE=seurat-signac
fi

if [[ -z ${SEURAT_IMAGE_VER} ]]
then
  echo -e "Seurat image version tag needs to be supplied using the -v argument.\n\nFind available versions at https://gallery.ecr.aws/chobiolab/$SEURAT_IMAGE"
  exit 1
fi

echo "Using Seurat image $SEURAT_IMAGE:$SEURAT_IMAGE_VER"

singularity run \
  --no-home \
  --pwd $APP_PATH \
  -B $DATA_PATH:$DATA_PATH \
  -B $APP_PATH:$APP_PATH \
  -B ./config/params.csv:/app/config/params.csv \
  -B ./config/samples.csv:/app/config/samples.csv \
  docker://public.ecr.aws/chobiolab/$SEURAT_IMAGE:$SEURAT_IMAGE_VER $APP_PATH/main "$@"

